<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <title>Registro de Serviços</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script id="search-js" defer="" src="https://api.mapbox.com/search-js/v1.0.0-beta.18/web.js"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;600&family=Roboto:ital,wght@0,400;1,500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="tabelaDeRegistro.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>



    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css"
        type="text/css" />

    <style>
        b {
            color: #9900ff;
        }


        .content {
            padding: 2rem;
            display: flex;
            flex-direction: column;
            ;

        }

        .span-required {
            display: none;
            font-size: 12px;
            color: rgb(255, 0, 0)
        }

        select {
            border-color: #8878ce;
        }

        select:focus {
            outline: none;
            /* Remove a borda padrão do foco */
            border: 3px solid #8878ce;
        }

        select option {
            color: rgb(89, 52, 114);
            background-color: #f2dfff;
        }



        .form-control {
            outline: none;
            /* Remove a borda padrão do foco */
            border-color: rgb(89, 52, 114);
            padding: 8px;
            /* Adiciona uma borda preta quando o input está em foco */
        }

        .form-control:focus {
            outline: none;
            /* Remove a borda padrão do foco */
            border: 3px solid #652b77;
        }
    </style>



</head>

<body>
    <header class="navbar navbar-expand-lg navbar-light bg-light fixed-header"
        style="background-color: #e9e4ff !important;">
        <a class="navbar-brand" href="index.html">
            <img src="../img/Logo.png" alt="" style="width: 100px;">FromHome
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse justify-content-center" style="margin-right: 100px" id="navbarNav"
            id="navbarNav">
            <ul class="navbar-nav text-center">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Sobre</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="listademandacliente.html">Suas Demandas</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="registroservicos.html">Criar Demanda</a>
                </li>
            </ul>
        </div>
        <div class="nav-item dropdown ml-2">
            <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                <img src="../img/foto_perfil.jpg" alt="Sua Foto de Perfil" class="rounded-circle" width="40" height="40">
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="profileDropdown"
                style="background-color: rgb(229, 216, 255); color: rgb(0, 0, 0); border: 3px;">
                <a class="dropdown-item" href="#">Perfil</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Sair</a>
            </div>
        </div>
    
    </header>

    <!-- Conteúdo principal da página -->
    <div class="content" style="margin-bottom: 60px; padding-bottom: 10%; color: rgb(89, 52, 114);">
        <!-- conteúdo principal -->
        <div class="row mt-5 justify-content-center">
            <div class="col-lg-7 mx-auto">
                <div class="card mt-5 mx-auto p-4" style="overflow: auto; ">
                    <div class="card-body">
                        <h1 class="text-center"><b>Registro de Serviço</b></h1>
                    </div>
                    <div class="container mt-5">
                        <form class="row g-3" method="POST" name="checkoutForm">
                            <div class="col-md-6">
                                <label for="inputNameS" class="form-label">Nome do serviço</label>
                                <input name="nome" class="form-control required" id="inputNomeServico"
                                    oninput="nameValidate()" />
                                <span class="span-required">
                                    <p>O nome deve ter no mínimo 4 caracteres</p>
                                </span>
                            </div>
                            <div class="col-md-4">
                                <label name="categoria" for="inputOpcoes" class="form-label ">Categoria</label>
                                <div class="col-md-6">
                                    <select id="inputOpcoes" class="form-select inputOpcoes required" required
                                        onchange="categoriaValidate()">
                                        <option value="" selected></option>
                                        <option>Babá Cuidados com Crianças</option>
                                        <option>Cozinha e Culinária</option>
                                        <option>Cuidados com Animais de Estimação</option>
                                        <option>Jardinagem</option>
                                        <option>Limpeza</option>
                                        <option>Manutenção Residencial</option>
                                        <option>Motorista Particular</option>
                                        <option>Organização de Espaços</option>
                                        <option>Serviços de Lavanderia</option>
                                        <option>Tutoria Acadêmica</option>
                                        <option>Outro</option>

                                    </select>

                                </div>
                                <span class="span-required">
                                    <p>É necessário escolher uma opção</p>
                                </span>
                            </div>
                            <div class="col-md-12 mt-2 col-sm-6 "> <!-- confirma senha -->
                                <label for="inputDescricaoServico" class="form-label ">Descrição do serviço</label>
                                <textarea name="descricao" class="form-control required" id="inputDescricaoServico"
                                    cols="25" rows="4" required oninput="descricaoValidate()"></textarea>
                                <span class="span-required">
                                    <p>A descrição deve ter no mínimo 20 caracteres</p>
                                </span>
                            </div>

                            <div class="col-md-6 mt-3 ml-1">
                                <label for="inputFotos" class="form-label">Fotos(opcional)</label>
                                <input name="foto" type="file" class="form-control" id="inputFotos" accept="image/*"
                                    style="resize: vertical;" rows="4" required />
                            </div>


                            <div class="row mt-3">
                                <!-- Coluna do endereço à esquerda -->
                                <div class="col-md-4 col-sm-6">
                                    <label for=" " class="form-label">Endereço</label>


                                    <label for="inputLocal" class="txt-s txt-bold color-gray mb-0 mt-0">(Rua)</label>
                                    <input class="input mb-3 form-control required" placeholder="Escreva seu endereco"
                                        autocomplete="address-line1" id="inputLocal" style="resize: vertical;" rows="2"
                                        oninput="enderecoValidate()">
                                    <span class="span-required">
                                        <p>O endereço deve ter no mínimo 3 caracteres</p>
                                    </span>

                                    <div id="manual-entry"
                                        class="w180 mt6 link txt-ms border-b color-gray color-black-on-hover"></div>
                                    <div class="secondary-inputs hide" style="resize: vertical;" rows="2">

                                        <label class="txt-s txt-bold color-gray mb3 md-1">Cidade</label>
                                        <input class="input mt-0 mb-3 form-control" placeholder="Cidade"
                                            autocomplete="address-level2" id="cityInput" readonly>

                                        <label class="txt-s txt-bold color-gray mb3 md-1">Estado / Região</label>
                                        <input class="input mb12 form-control" placeholder="Estado / Região"
                                            autocomplete="address-level1" id="stateInput" readonly>
                                    </div>
                                </div>



                                <!-- Coluna dos demais elementos à direita -->
                                <div class="row mt-8 ml-5">
                                    <div class="col-md-12" onchange="disponibilidadeValidate()">
                                        <div class="row mb-8 ml-0">
                                            <div class="col-md-12 col-sm-12 ml-5">
                                                <label for="inputDisponibilidade" class="form-label">Horário
                                                    estimado</label>
                                                <input name="disponibilidade" type="time" class="form-control required"
                                                    id="inputDisponibilidade" required style="width: 100%;" />
                                                <span class="span-required">
                                                    <p>Horário minímo 30min</p>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="row mb-8 ml-0">
                                            <div class="col-md-12 col-sm-12 ml-5 mt-3">
                                                <label for="inputData" class="form-label">Data de previsão</label>
                                                <input name="data" type="date" class="form-control required"
                                                    id="inputData" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" max="9999-12-31"
                                                    required onchange="dataValidate()" />
                                                <span class="span-required">
                                                    <p>Insira uma data posterior à atual</p>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="row mt-8 ml-0 mt-1">
                                            <div class="col-md-12 col-sm-12 ml-5">
                                                <label for="inputPreco" class="form-label">Valor</label>
                                                <input name="preco" type="text" class="form-control required"
                                                    id="inputPreco" step="000.01" placeholder="R$:" style="width: 100%"
                                                    required onblur="precoValidate()" />
                                                <span class="span-required">
                                                    <p>Mensagem de validação para valor</p>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <div class="col-md-2">
                                    <!-- Visual confirmation map -->
                                    <div id="minimap-container" class="none h240 w360 relative mt18"></div>
                                </div>
                            </div>
                            <div id="validation-msg" class="mt24 txt-m txt-bold none"></div>

                            <div class="container mt-5">
                                <div class="row">
                                    <div class="col"></div>
                                    <div class="col-md-5">
                                        <div class="form-check">
                                            <input name="contato" class="form-check-input" type="checkbox"
                                                id="gridCheck" />
                                            <label class="form-check-label" for="gridCheck">
                                                Mostrar meu número de contato
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <button id="postarBtn" type="submit" class="btn btn-primary">
                                            Postar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>



                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-light mt-5" style="
        background-color: rgb(58, 50, 77);
       
        bottom: 0;
        width: 100%;
        margin-top: 20px;
      ">
        <div class="navbar navbar-expand-lg navbar-light bg-light" style="background-color: #e9e4ff !important">
            <a class="navbar-brand" href="#"><img src="img/Logo.png" alt="" style="width: 100px" /></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" style="margin-right: 100px" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" id="termosDeUso">Termos de Uso</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="politicasPrivacidade">Políticas de Privacidade</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="container text-center mt-1">
            <p>Contato: contato@fromhome.com<br />Telefone: (11) 1234-5678</p>
        </div>
        <p class="text-center small">
            &copy; 2023 FromHome. Todos os direitos reservados.
        </p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="server.js"></script>


    <script> //para validar o formulario
        const form = document.querySelector('.row.g-3');
        const campos = document.querySelectorAll('.required');
        const span = document.querySelectorAll('.span-required');



        function setError(index) {
            campos[index].style.border = '2px solid #ff0000';
            span[index].style.display = 'block';
        }

        function removeError(index) {
            campos[index].style.border = '2px solid #652b77 ';
            span[index].style.display = 'none';
        }













        //validar os campos

        //nome
        function nameValidate() {
            if (campos[0].value.length < 4) {
                setError(0);
                return false;
            }
            else {
                removeError(0);
                return true;
            }

        }


        //categoria
        function categoriaValidate() {
            const selectElement = document.getElementById('inputOpcoes');
            const selectedOption = selectElement.options[selectElement.selectedIndex].value;

            if (selectedOption === '') {
                console.log('Você não selecionou nada');
                setError(1);
                return false;
            } else {
                console.log('Você selecionou: ' + selectedOption);
                removeError(1);
                return true;
            }
        }

        // Adicionando um ouvinte de evento para escutar o clique no menu de opções
        document.getElementById('inputOpcoes').addEventListener('click', () => {
            const selectedOption = document.getElementById('inputOpcoes').value;
            if (selectedOption === '') {
                console.log('Você não selecionou nada');
                setError(1);
            }
        });

        // Adicionando um ouvinte de evento para reverter a borda quando o usuário interagir novamente com o select


        function descricaoValidate() {
            if (campos[2].value.length < 20) {
                setError(2);
                return false;
            }
            else {
                removeError(2);
                return true;
            }

        }



        function enderecoValidate() {
            const enderecoIndex = 3; // Índice correspondente ao campo de endereço
            if (campos[enderecoIndex].value.length < 4) {

                setError(enderecoIndex);
                return false;
            } else {
                removeError(enderecoIndex);
                return true;
            }
        }





        function disponibilidadeValidate() {
            const disponibilidadeIndex = 4; // Índice correspondente ao campo de horário estimado
            const valor = campos[disponibilidadeIndex].value;

            // Convertendo o valor para um objeto Date
            const timeValue = new Date(`2000-01-01T${valor}`);

            // Criando um objeto Date representando 30 minutos após a meia-noite
            const thirtyMinutesAfterMidnight = new Date(`2000-01-01T00:30:00`);

            // Verificando se o valor é maior ou igual a 30 minutos após a meia-noite
            if (timeValue.getTime() < thirtyMinutesAfterMidnight.getTime()) {
                console.log('O horário deve ser maior que 00:30');
                setError(disponibilidadeIndex);
                return false;
            } else {
                removeError(disponibilidadeIndex);
                return true;
            }
        }

        function dataValidate() {
            const dataIndex = 5; // Índice correspondente ao campo de data
            const inputDate = document.getElementById('inputData');
            const valor = inputDate.value;

            // Obtendo a data e hora atual
            const dataAtual = new Date();

            // Convertendo o valor para um objeto Date
            const dataSelecionada = new Date(`${valor}T00:00:00`);

            // Ajustando o valor para garantir o formato desejado (DD/MM/YYYY)
            const formattedDate = `${dataSelecionada.getFullYear()}-${String(dataSelecionada.getMonth() + 1).padStart(2, '0')}-${String(dataSelecionada.getDate()).padStart(2, '0')}`;

            // Definindo o valor ajustado de volta no campo
            inputDate.value = formattedDate;

            // Verificando se a data selecionada é posterior à data atual
            if (dataSelecionada <= dataAtual) {
                console.log('A data deve ser posterior à data atual');
                setError(dataIndex);
                return false;
            } else {
                removeError(dataIndex);
                return true;
            }
        }




        function precoValidate() {
            const precoIndex = 6; // Índice correspondente ao campo de preço
            const inputPreco = campos[precoIndex];

            // Obter o valor atual do campo sem remover formatação
            const valorAtual = inputPreco.value;

            // Verificar se o valor atual já contém uma vírgula
            const contemVirgula = valorAtual.includes(',');

            // Remover qualquer formatação de moeda antes de converter para número
            const valorStr = valorAtual.replace(/[^\d,]/g, '');

            // Verificar se a string contém notação científica
            const isScientificNotation = valorStr.toLowerCase().includes('e');

            // Se não for notação científica, converter para número
            const valorNumerico = isScientificNotation ? 0 : parseFloat(valorStr.replace(',', '.'));

            if (isNaN(valorNumerico) || valorNumerico <= 0) {
                console.log('O valor deve ser maior que zero');
                setError(precoIndex);
                return false;
            } else {
                removeError(precoIndex);

                // Atualizar o valor do campo sem formatação durante a entrada
                inputPreco.value = valorNumerico.toFixed(2);

                // Adicionar ",00" ao valor para garantir duas casas decimais com vírgula
                const valorFormatado = contemVirgula
                    ? valorNumerico.toLocaleString('pt-BR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                    })
                    : valorNumerico.toFixed(2).replace('.', ',');

                // Atualizar o valor do campo com a versão formatada
                inputPreco.value = valorFormatado;
                return true;
            }
        }

        // Adicionar um ouvinte de evento 'blur' para chamar precoValidate quando o foco é retirado do campo
        document.getElementById('inputPreco').addEventListener('blur', precoValidate);

    </script>

    <script>
        const ACCESS_TOKEN = 'pk.eyJ1Ijoid2FuZXNzYWNyaXN0aW5hIiwiYSI6ImNscHBmeDN3bDBwNXoyanBwNDd1NHdjbWoifQ.mn9RiaWKROJGkiLQynhltg';

        let autofillCollection;
        let minimap;


        // Form operation functions
        function showMap() {
            const el = document.getElementById("minimap-container");
            el.classList.remove("none");
        }

        function hideMap() {
            const el = document.getElementById("minimap-container");
            el.classList.add("none");
        }

        const manualEntryButton = document.getElementById("manual-entry");
        if (manualEntryButton) {
            manualEntryButton.addEventListener("click", expandForm);
        }

        function expandForm() {
            document.getElementById("manual-entry").classList.add("hide");
            document.querySelector(".secondary-inputs").classList.remove("hide");
        }

        function collapseForm() {
            document.getElementById("manual-entry").classList.remove("hide");
            document.querySelector(".secondary-inputs").classList.add("hide");
        }

        function setValidationText(color, msg, clear = false) {
            const validationTextElement = document.getElementById("validation-msg");
            if (clear) validationTextElement.classList.add("none");
            validationTextElement.classList.remove("color-green", "color-red");
            validationTextElement.classList.add(`color-${color}`);
            validationTextElement.innerText = msg;
            validationTextElement.classList.remove("none");
        }

        function submitForm() {
            setValidationText("green", "Order successfully submitted.");
            setTimeout(() => {
                resetForm();
            }, 2500);
        }

        function resetForm() {
            const inputs = document.querySelectorAll("input");
            inputs.forEach(input => input.value = "");
            collapseForm();
            setValidationText("green", "", true)
            autofillCollection.update();
            minimap.feature = null;
        }

        // Bind functions to HTML buttons
        document.getElementById("manual-entry").addEventListener("click", expandForm);

        // Autofill initialization
        document.getElementById("search-js").onload = () => {
            mapboxsearch.config.accessToken = ACCESS_TOKEN;

            autofillCollection = mapboxsearch.autofill({});

            minimap = new MapboxAddressMinimap();
            minimap.canAdjustMarker = true;
            minimap.satelliteToggle = true;
            minimap.onSaveMarkerLocation = (lnglat) => {
                console.log(`Marker moved to ${lnglat}`);
            };
            const minimapContainer = document.getElementById("minimap-container");
            minimapContainer.appendChild(minimap);

            autofillCollection.addEventListener(
                "retrieve",
                async (e) => {
                    expandForm();
                    if (minimap) {
                        minimap.feature = e.detail.features[0];
                        showMap();
                    }
                }
            );

            document.addEventListener("DOMContentLoaded", () => {
                const form = document.forms.checkoutForm;

                form.addEventListener("submit", async (e) => {
                    e.preventDefault();


                    // Obtendo dados do formulário
                    const addressInput = document.getElementById("inputLocal");
                    const cityInput = document.getElementById("cityInput");
                    const stateInput = document.getElementById("stateInput");

                    // Obtendo dados da biblioteca Mapbox Search
                    const address = autofillCollection.get("address-line1");

                    // Criando um objeto com os dados do formulário
                    const formData = {
                        address: addressInput.value,
                        city: cityInput.value,
                        state: stateInput.value,
                        mapboxAddress: address,
                        // Adicione mais campos conforme necessário
                    };

                    // Convertendo para JSON
                    const jsonData = JSON.stringify(formData);

                    // Exibindo os dados em JSON no console (você pode enviar ou processar conforme necessário)
                    console.log(jsonData);

                    // Restante do seu código...
                });
            }
            )
        }


        function dataValidate() {
            const dataIndex = 5; // Índice correspondente ao campo de data
            const inputDate = document.getElementById('inputData');
            const mensagemErroData = document.getElementById('mensagemErroData');
            const valor = inputDate.value;

            // Obtendo a data e hora atual
            const dataAtual = new Date();

            // Convertendo o valor para um objeto Date
            const dataSelecionada = new Date(valor);

            // Calculando a diferença em anos
            const diffAnos = Math.floor((dataAtual - dataSelecionada) / (365.25 * 24 * 60 * 60 * 1000));

            // Verificando se a idade é menor que 18 anos
            if (diffAnos < 18) {
                console.log('O usuário deve ter mais de 18 anos');
                setError(inputDate, mensagemErroData);
                return false;
            } else {
                removeError(inputDate, mensagemErroData);
                return true;
            }
        }

        function setError(inputElement, errorSpan) {
            inputElement.style.border = '2px solid #ff0000';
            errorSpan.style.display = 'block';  // Exibe a mensagem de erro
        }

        function removeError(inputElement, errorSpan) {
            inputElement.style.border = '2px solid #652b77';
            errorSpan.style.display = 'none';  // Oculta a mensagem de erro
        }

    </script>
</body>

</html>